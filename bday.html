<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Happy Birthday ❤️</title>
  <meta name="theme-color" content="#ff4d79" />
  <style>
    :root{
      --bg1:#0f0c29; --bg2:#302b63; --bg3:#24243e; 
      --accent:#ff4d79; --accent-2:#ffd166; --card:#ffffff10; --text:#f8f8ff; --muted:#cfcfe6;
      --glass: rgba(255,255,255,0.08);
      --blur: blur(8px);
      --shadow: 0 10px 30px rgba(0,0,0,.25);
      --radius: 22px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 80% -10%, #ff6f91 0%, rgba(255,111,145,0) 40%), linear-gradient(135deg,var(--bg1),var(--bg2) 45%,var(--bg3));
      overflow-x:hidden;
    }
    .noise{position:fixed; inset:0; pointer-events:none; opacity:.03; background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="120" height="120" viewBox="0 0 120 120"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.65" numOctaves="3" stitchTiles="stitch"/></filter><rect width="120" height="120" filter="url(%23n)" opacity="0.5"/></svg>');}

    /* Floating hearts canvas behind everything */
    #bgCanvas{position:fixed; inset:0; z-index:0}

    header.hero{
      position:relative; z-index:1; min-height:92dvh; display:grid; place-items:center; text-align:center; padding:24px; overflow:hidden;
    }
    .hero-inner{ backdrop-filter: saturate(140%) blur(6px); background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.15); padding:24px; border-radius:var(--radius); box-shadow:var(--shadow); max-width:860px; width:clamp(300px,90vw,860px);
    }
    h1.title{ font-size: clamp(28px, 7vw, 62px); line-height:1.05; margin:10px 0 6px; letter-spacing:.5px}
    .type{ color:var(--accent); font-weight:700; display:inline-block; min-height:1.2em }
    p.subtitle{ color:var(--muted); font-size: clamp(14px, 3.4vw, 18px); margin:8px 0 18px }

    .controls{ display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin:16px 0 4px }
    button, .ghost{
      appearance:none; border:0; padding:12px 16px; border-radius:18px; background:linear-gradient(180deg,#ff5e8a,#ff2f6e); color:white; font-weight:700; letter-spacing:.2px; box-shadow:0 6px 16px rgba(255,77,121,.35); cursor:pointer; transition: transform .08s ease, filter .2s ease; display:inline-flex; align-items:center; gap:8px
    }
    button:active{ transform: translateY(1px) scale(.99)}
    .ghost{ background:transparent; border:1px solid rgba(255,255,255,.22); box-shadow:none; color:var(--text) }

    main{ position:relative; z-index:1 }

    /* Photo gallery */
    .section{ padding: 20px clamp(14px,4vw,40px) }
    .card{ background:var(--glass); border:1px solid rgba(255,255,255,.14); border-radius:var(--radius); box-shadow:var(--shadow) }

    .gallery{ display:grid; grid-template-columns: repeat(2,1fr); gap:10px }
    @media(min-width:720px){ .gallery{ grid-template-columns: repeat(4, 1fr) } }
    .gallery .item{ position:relative; border-radius:16px; overflow:hidden; aspect-ratio:1/1; background:#1b1b2d }
    .gallery img{ width:100%; height:100%; object-fit:cover; display:block; }
    .badge{ position:absolute; bottom:8px; left:8px; background:rgba(0,0,0,.45); color:#fff; padding:6px 10px; border-radius:14px; font-size:12px; backdrop-filter: blur(4px)}

    .uploader{ padding:14px; display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:center }
    .uploader input[type=file]{ display:none }
    .uploader label{ padding:10px 14px; border:1px dashed rgba(255,255,255,.25); border-radius:14px; cursor:pointer }

    /* Lightbox */
    .lightbox{ position:fixed; inset:0; background:rgba(0,0,0,.7); display:none; align-items:center; justify-content:center; z-index:99 }
    .lightbox.active{ display:flex }
    .lightbox img{ max-width:96vw; max-height:80vh; border-radius:16px; box-shadow:var(--shadow) }
    .lightbox .close{ position:fixed; top:14px; right:14px }

    /* Love meter */
    .meter{ display:flex; align-items:center; gap:12px; padding:16px }
    .bar{ flex:1; height:12px; background:rgba(255,255,255,.15); border-radius:999px; overflow:hidden }
    .bar > span{ display:block; height:100%; width:8%; background: linear-gradient(90deg, #ff8fab, #ff2f6e); transition: width .4s ease }

    /* Message timeline */
    .timeline{ display:grid; gap:12px; padding:12px }
    .tcard{ padding:16px; border-radius:16px; background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06)); border:1px solid rgba(255,255,255,.1); transform: translateY(10px); opacity:0; transition: .6s ease }
    .tcard.show{ transform:none; opacity:1 }
    .tcard h3{ margin:0 0 6px; font-size:18px }
    .tcard p{ margin:0; color:var(--muted) }

    /* Footer note */
    footer{ text-align:center; color:var(--muted); padding:40px 16px 60px }

    /* Confetti bits */
    .confetti{ position:fixed; width:10px; height:10px; top:-10px; left:0; opacity:.9; transform: translateZ(0); will-change: transform, opacity; border-radius:2px }

    /* Floating decorative blobs */
    .blob{ position:absolute; filter: blur(40px); opacity:.22; z-index:0 }
    .blob.one{ width:300px; height:300px; background:#ff2f6e; top:-60px; left:-40px; }
    .blob.two{ width:260px; height:260px; background:#00d4ff; bottom:-40px; right:-40px }

    /* Tooltip tiny */
    .hint{ font-size:12px; color:#e8e8ff; opacity:.8; margin-top:6px }

    /* Editable text */
    [contenteditable]{ outline: none }
    .editable{ border-bottom:1px dashed rgba(255,255,255,.25) }
  </style>
</head>
<body>
  <canvas id="bgCanvas"></canvas>
  <div class="noise"></div>
  <header class="hero">
    <div aria-hidden class="blob one"></div>
    <div aria-hidden class="blob two"></div>

    <div class="hero-inner card">
      <div class="controls" style="justify-content:flex-end">
        <button id="confettiBtn" aria-label="celebrate">🎉 Confetti</button>
        <button id="shareBtn" class="ghost" aria-label="share">📤 Share</button>
      </div>
      <h1 class="title">
        <span class="type" id="type"></span>
      </h1>
      <p class="subtitle">
        <span class="editable" contenteditable spellcheck="false" id="subtitle">You make my world compile without errors and run at O(❤️).</span>
      </p>
      <div class="controls">
        <label for="photoInput" class="ghost">➕ Add Photos</label>
        <input id="photoInput" type="file" accept="image/*" multiple>
        <label for="audioInput" class="ghost">🎵 Add Song</label>
        <input id="audioInput" type="file" accept="audio/*">
        <button id="musicBtn">▶️ Play Music</button>
        <button id="loveBtn">💗 Boost Love Meter</button>
      </div>
      <div class="hint">Tip: Tap the subtitle to edit your custom message. Add photos & a song from your phone.</div>
    </div>
  </header>

  <main>
    <!-- Gallery -->
    <section class="section card">
      <div class="uploader">
        <strong>Our Gallery</strong>
      </div>
      <div id="gallery" class="gallery" aria-live="polite"></div>
    </section>

    <!-- Love Meter -->
    <section class="section card" style="margin-top:16px">
      <div class="meter">
        <strong>Love Meter</strong>
        <div class="bar" aria-label="love-level"><span id="meterBar" style="width:12%"></span></div>
        <span id="meterVal">12%</span>
      </div>
    </section>

    <!-- Timeline messages -->
    <section class="section card" style="margin-top:16px">
      <div class="timeline" id="timeline">
        <article class="tcard"><h3>Level 1: Hello World 💫</h3><p>The day I met you, my heart printed its first log: <em>"Hello, Beautiful"</em>.</p></article>
        <article class="tcard"><h3>Level 2: Commit to Love 🧡</h3><p>Commit message: <code>feat: us — add laughter, late-night talks, and infinite hugs</code></p></article>
        <article class="tcard"><h3>Level 3: Deploy Happiness 🚀</h3><p>CI/CD status: <strong>Passed</strong>. Your smile went to production and uptime is 100%.</p></article>
        <article class="tcard"><h3>Level 4: Forever Support 🛡️</h3><p>Issue tracker: I’m here for every bug, patch, and version update of life.</p></article>
      </div>
    </section>

    <!-- Secret message -->
    <section class="section card" style="margin-top:16px; text-align:center; padding:28px">
      <h3 style="margin:0 0 10px">Press & Hold to Reveal 💌</h3>
      <p id="secret" style="filter: blur(7px); transition:.35s ease">You are my favorite feature, my constant, and my forever best decision. Happy Birthday, love! 💖</p>
    </section>
  </main>

  <footer>
    Made with ♥ by <span class="editable" id="byName" contenteditable spellcheck="false">Priyanshu</span> · <span id="year"></span>
  </footer>

  <div class="lightbox" id="lightbox" role="dialog" aria-modal="true" aria-label="Photo viewer">
    <button class="ghost close" id="closeLightbox">✖</button>
    <img id="lightImg" alt="Selected photo" />
  </div>

  <audio id="player" preload="metadata"></audio>

  <script>
    // =======================
    // Typewriter Title
    // =======================
    const messages = [
      "Happy Birthday, My Love ❤️",
      "You + Me = Perfect Algorithm",
      "To the Queen of My Debug Logs 👑",
    ];
    const typeEl = document.getElementById('type');
    let mi = 0, ci = 0, erase = false;
    function loopType(){
      const msg = messages[mi % messages.length];
      if(!erase){
        typeEl.textContent = msg.slice(0, ++ci);
        if(ci === msg.length){ erase = true; setTimeout(loopType, 1100); return; }
      } else {
        typeEl.textContent = msg.slice(0, --ci);
        if(ci === 0){ erase = false; mi++; }
      }
      setTimeout(loopType, erase ? 24 : 38);
    }
    loopType();

    // =======================
    // Floating Hearts Canvas
    // =======================
    const canvas = document.getElementById('bgCanvas');
    const ctx = canvas.getContext('2d');
    let W,H; const hearts=[];
    function resize(){ W = canvas.width = innerWidth; H = canvas.height = innerHeight; }
    addEventListener('resize', resize); resize();
    function heartPath(x,y,s){
      ctx.beginPath();
      ctx.moveTo(x, y);
      ctx.bezierCurveTo(x-s, y-s, x-2*s, y+s*0.2, x, y+1.4*s);
      ctx.bezierCurveTo(x+2*s, y+s*0.2, x+s, y-s, x, y);
    }
    for(let i=0;i<36;i++) hearts.push({x: Math.random()*innerWidth, y:Math.random()*innerHeight, s: 6+Math.random()*10, a: .15+.35*Math.random(), vy: .2+.6*Math.random(), vx:(Math.random()-.5)*.2});
    (function animate(){
      ctx.clearRect(0,0,W,H);
      for(const h of hearts){
        ctx.save();
        ctx.globalAlpha = h.a;
        ctx.fillStyle = '#ff4d79';
        heartPath(h.x, h.y, h.s);
        ctx.fill();
        ctx.restore();
        h.y += h.vy; h.x += h.vx; if(h.y>H+20){ h.y = -20; h.x = Math.random()*W; }
      }
      requestAnimationFrame(animate);
    })();

    // =======================
    // Confetti
    // =======================
    function confettiBurst(n=80){
      const colors = ['#ff4d79','#ffd166','#06d6a0','#118ab2','#9b5de5'];
      const container = document.body;
      for(let i=0;i<n;i++){
        const c = document.createElement('div');
        c.className='confetti';
        c.style.left = Math.random()*100 + 'vw';
        c.style.background = colors[i%colors.length];
        c.style.transform = `rotate(${Math.random()*360}deg)`;
        const fall = 6 + Math.random()*4; // seconds
        const drift = (Math.random()*.6 - .3) * 100; // px
        c.animate([
          { transform:`translate(0, -10px) rotate(0deg)` },
          { transform:`translate(${drift}px, 110vh) rotate(${Math.random()*720}deg)` }
        ], { duration: fall*1000, easing:'cubic-bezier(.2,.6,.2,1)' });
        setTimeout(()=> c.remove(), fall*1000);
        container.appendChild(c);
      }
    }
    document.getElementById('confettiBtn').addEventListener('click', ()=> confettiBurst());

    // =======================
    // Share API
    // =======================
    document.getElementById('shareBtn').addEventListener('click', async ()=>{
      const text = `${document.getElementById('type').textContent} — from ${document.getElementById('byName').textContent}`;
      try{
        if(navigator.share){ await navigator.share({ title:'Happy Birthday ❤️', text, url: location.href }); }
        else { alert('Sharing not supported on this device. You can still send the link or screenshot!'); }
      }catch(e){ /* user cancelled */ }
    });

    // =======================
    // Photo Uploader + Gallery + Lightbox + Swipe
    // =======================
    const input = document.getElementById('photoInput');
    const gallery = document.getElementById('gallery');
    const lightbox = document.getElementById('lightbox');
    const lightImg = document.getElementById('lightImg');
    const closeLb = document.getElementById('closeLightbox');
    const images = []; let current = 0;

    function addToGallery(file){
      const url = URL.createObjectURL(file);
      images.push(url);
      const item = document.createElement('div');
      item.className = 'item';
      const img = document.createElement('img');
      img.loading = 'lazy'; img.src = url; img.alt = file.name || 'photo';
      img.addEventListener('click', ()=> openLightbox(images.length-1));
      const b = document.createElement('div'); b.className='badge'; b.textContent='💖';
      item.append(img,b); gallery.prepend(item);
    }

    input.addEventListener('change', (e)=>{
      [...e.target.files].forEach(addToGallery);
      if(e.target.files.length) confettiBurst(50);
    });

    function openLightbox(i){ current = i; lightImg.src = images[current]; lightbox.classList.add('active'); }
    function closeLightbox(){ lightbox.classList.remove('active'); }
    closeLb.addEventListener('click', closeLightbox);
    lightbox.addEventListener('click', (e)=>{ if(e.target===lightbox) closeLightbox(); });

    // Swipe support
    let sx=0, sy=0, dx=0, dy=0, swiping=false;
    lightbox.addEventListener('touchstart', (e)=>{ const t=e.touches[0]; sx=t.clientX; sy=t.clientY; swiping=true; });
    lightbox.addEventListener('touchmove', (e)=>{ if(!swiping) return; const t=e.touches[0]; dx=t.clientX-sx; dy=t.clientY-sy; });
    lightbox.addEventListener('touchend', ()=>{
      if(Math.abs(dx)>50 && Math.abs(dx)>Math.abs(dy)){
        current = (current + (dx>0?-1:1) + images.length) % images.length; lightImg.src = images[current];
      }
      dx=dy=0; swiping=false;
    });

    // =======================
    // Music Player (user-supplied file)
    // =======================
    const audioInput = document.getElementById('audioInput');
    const player = document.getElementById('player');
    const musicBtn = document.getElementById('musicBtn');
    let hasAudio = false, playing = false;
    audioInput.addEventListener('change', (e)=>{
      const file = e.target.files?.[0];
      if(file){ player.src = URL.createObjectURL(file); hasAudio = true; musicBtn.textContent='▶️ Play Music'; }
    });
    musicBtn.addEventListener('click', async ()=>{
      if(!hasAudio){ alert('Add a song first (tap 🎵 Add Song)'); return; }
      if(playing){ player.pause(); musicBtn.textContent='▶️ Play Music'; playing=false; }
      else{ try{ await player.play(); musicBtn.textContent='⏸️ Pause Music'; playing=true; }catch(e){ alert('Tap the page once, then try play again (browser policy)'); } }
    });

    // =======================
    // Love Meter
    // =======================
    const bar = document.getElementById('meterBar');
    const val = document.getElementById('meterVal');
    let love = 12; const loveBtn = document.getElementById('loveBtn');
    const bump = () => { love = Math.min(100, love + Math.floor(5 + Math.random()*18)); bar.style.width = love+'%'; val.textContent = love+'%'; };
    loveBtn.addEventListener('click', ()=>{ bump(); confettiBurst(24); });

    // =======================
    // Reveal secret (press & hold)
    // =======================
    const secret = document.getElementById('secret');
    let holdTimer;
    const reveal = ()=> secret.style.filter='blur(0px)';
    const hide = ()=> secret.style.filter='blur(7px)';
    secret.addEventListener('touchstart', ()=>{ holdTimer=setTimeout(reveal, 400); });
    secret.addEventListener('mousedown', ()=>{ holdTimer=setTimeout(reveal, 400); });
    ['touchend','mouseup','mouseleave'].forEach(ev=> secret.addEventListener(ev, ()=>{ clearTimeout(holdTimer); hide(); }));

    // =======================
    // Timeline reveal on scroll
    // =======================
    const io = new IntersectionObserver(entries=>{
      for(const e of entries){ if(e.isIntersecting) e.target.classList.add('show'); }
    }, { threshold: .2 });
    document.querySelectorAll('.tcard').forEach(el=> io.observe(el));

    // Footer year
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>
